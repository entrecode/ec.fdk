<div style="width:180px;float:right">
<?xml version="1.0" encoding="UTF-8"?><svg id="a" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600.7"><path d="M422.28,308.6c12.1,.99,24.4,1.93,36.68,3.02,10.25,.91,20.47,2.25,30.73,2.95,8.72,.59,16.86-1.5,23.84-7.14,.67-.54,1.5-.89,3.35-.97-.51,2.22-.35,4.99-1.65,6.54-3.35,3.95-6.84,8.19-11.18,10.83-11.86,7.22-25.26,10.37-38.95,10.76-13.61,.38-27.26-.86-40.9-1.16-9.3-.21-18.61-.04-27.91,.51,67.15,9.38,61.72,8.24,89.33,4-18.08,12.19-36.83,20.92-57.58,26.24,7.5,2.43,11.84,2.44,26.68,.21-.14,3.48-2.65,7.26-7.16,10.55-10.06,7.34-21.67,11.05-33.55,13.95-19.56,4.77-39.52,4.97-59.5,4.64-4.34-.07-8.68-.01-13.08,.5,13.06,5.11,26.62,7.46,40.58,8.25,14.01,.8,27.7-.13,41.35-5.71-1.72,6.11-4.73,10.97-8.58,15.2-13.73,15.11-31.1,23.32-51.16,25.82-8.13,1.01-16.37,1.11-24.88,1.64,7.81,4.66,16.19,6.12,25.16,5.64,9.06-.48,17.1-3.93,24.99-8.02l.69,1.08c-4.32,3.12-8.4,6.64-13,9.28-9.97,5.74-21,8.44-32.39,8.92-11.44,.48-22.92,.09-34.39,.17-4.05,.03-8.08,.36-11.57,2.61-.03,.42-.06,.84-.09,1.26,4.4,1.01,8.74,2.42,13.2,2.96,8.81,1.06,17.69,1.48,26.51,2.5,3.96,.46,8.31,.46,12,5.17-5.69,.88-10.65,1.97-15.66,2.37-15.15,1.2-30.32,2.19-45.48,3.14-7.99,.5-13.88,3.51-18.92,10.37-11.03,15.03-22.99,29.38-34.89,43.74-3.07,3.71-7.19,6.63-11.09,9.54-3.81,2.84-5.58,1.91-5.67-2.8-.17-9.14,1.61-18.03,5.57-26.18,5.77-11.89,12.15-23.49,18.5-35.1,1.53-2.8,1.75-4.72-.21-7.52-11.84-16.89-16.41-35.89-14.88-56.27,.48-6.41,2.51-12.7,3.83-19.05,.53,.04,1.06,.08,1.58,.12,.71,4.18,1.4,8.37,2.15,12.55,2.69,14.92,10.18,25.93,25.16,30.8,.48,.16,.99,.27,1.49,.34,.23,.03,.49-.09,1.03-.21-24.43-41.45-22.83-82.24,2.85-122.39-4.98,30.59-5.84,60.27,16.21,85.4l1.05-.21c-1.74-6.26-3.73-12.47-5.17-18.8-5.96-26.36-3.47-52.1,6.06-77.27,11.48-30.31,28.74-57.12,49.52-81.8,1.07-1.27,2.27-2.43,3.75-3.56-15.63,32.01-20.12,63.68,2.05,94.7-1.17-6.2-2.54-12.38-3.46-18.61-3.12-21.15,.23-41.53,8.08-61.21,10.57-26.48,27.36-48.55,48.77-67.19,13.82-12.03,28.71-22.59,44.54-31.81,.53-.31,1.06-.61,1.9-.52-5.28,4.71-10.58,9.39-15.82,14.14-15.82,14.35-29.43,30.37-36.68,50.83-8.79,24.81-8.11,49.39,3.27,73.45-.24-1.9-.48-3.79-.72-5.69-.25-2.04-.54-4.08-.75-6.12-2.53-24.69,3-47.77,14.1-69.68,15.33-30.27,38.64-52.73,68.11-69.05,7.04-3.9,14.28-7.42,21.72-10.73-11.64,9.33-21.57,19.84-25.93,34.45-4.32,14.5-4.72,28.76,3.9,42.3,.07-.67,.24-1.35,.2-2.01-1.8-31.86,13.48-54.27,39.33-70.67,20.17-12.8,42.33-20.47,65.93-23.39,11.94-1.48,24.14-2.04,36.16-1.57,31.31,1.23,49.5,29.26,38.31,58.8-8.47,22.34-25.75,35.7-47.51,43.79-5.34,1.99-11.07,2.94-17.49,4.59,16.75,6.65,30.66,1.21,44.37-7.67-9.53,14.85-45.53,39.76-73.29,50.86-28.3,11.31-58.02,14.03-88.26,14.97,5.4,1.04,10.75,2.49,16.2,3.03,13.43,1.32,26.89,2.85,40.37,3.14,25.98,.57,48.3-8.57,66.5-27.34,.35-.36,.77-.67,1.15-1.01l.85,.58c-2.92,4.18-5.44,8.71-8.81,12.5-23.65,26.59-51.9,46.08-87.16,53.55-11.25,2.38-23.01,2.34-34.51,3.63-12.37,1.39-24.72,3.03-37.07,4.62-1.05,.14-2.05,.69-2.69,.91Zm145.37-151.72c-1.45,.43-1.79,.5-2.1,.63-1.52,.67-3.05,1.33-4.54,2.05-50.38,24.25-95.21,56.55-136.02,94.54-38.56,35.9-73.82,74.85-105.49,116.98-29.04,38.64-55.18,79.14-77.54,122.02-4.66,8.93-8.62,18.22-12.91,27.34,13.09-14.03,25.94-27.99,36.34-44.09,40.57-62.84,84.8-122.91,135.35-178.21,43.47-47.55,90.87-90.55,144.44-126.52,7.11-4.78,14.32-9.41,22.46-14.74Z"/></svg>
</div>

# ec.fdk

*F*eatherweight *D*evelopment *K*it for entrecode APIs.

[ec.fdk docs](https://entrecode.github.io/ec.fdk)

## Install

```sh
npm i ec.fdk
```

## Getting Started

There are 2 ways to use ec.fdk:

- method chaining
- act

### Method Chaining

Start by calling `fdk` with your environment (`stage` | `live`), then method chain your way to success:

```js
import { fdk } from 'ec.fdk';

fdk('stage') // choose stage environment
  .dm('83cc6374') // select datamanager via short id
  .model('muffin') // select model muffin
  .entryList() // load entry list
  .then((list) => {
    console.log(list);
  });
```

See all functions in the [Fdk reference](https://entrecode.github.io/ec.fdk/classes/Fdk.html).

### act

The act function converts a single object param into a fetch request:

```js
const muffins = await act({
  action: 'entryList',
  env: 'stage',
  dmShortID: '83cc6374',
  model: 'muffin',
});
```

More in the [act reference](https://entrecode.github.io/ec.fdk/functions/act.html).

### Using act with swr / react-query

The act function is good to be used with swr or react-query:

```js
import { act } from 'ec.fdk';
import useSWR from 'swr';

export function useFdk(config) {
  const key = config ? JSON.stringify(config) : null;
  return useSWR([key], () => act(config));
}
```

Then use the hook:

```js
const config = {
  env: 'stage',
  dmShortID: '83cc6374',
};

function App() {
  const { data: entryList } = useFdk({
    ...config,
    action: 'entryList',
    model: 'muffin',
  });
  /* more stuff */
}
```

## CLI

ec.fdk also ships a CLI for quick shell-based interaction with entrecode APIs. Output is JSON, so you can pipe it into `jq` and friends.

### Usage

```sh
npx ec.fdk <command> [options]
```

Or install globally:

```sh
npm i -g ec.fdk
ec.fdk <command> [options]
```

### Commands

| Command          | Description                                    |
| ---------------- | ---------------------------------------------- |
| `login`          | Login with ec credentials (interactive prompt) |
| `dmList`         | List datamanagers                              |
| `modelList`      | List models of a datamanager                   |
| `getDatamanager` | Get a single datamanager                       |
| `entryList`      | List entries                                   |
| `getEntry`       | Get a single entry                             |
| `createEntry`    | Create an entry                                |
| `editEntry`      | Edit an entry                                  |
| `deleteEntry`    | Delete an entry                                |
| `getSchema`      | Get model schema                               |

### Options

| Option               | Description                                       |
| -------------------- | ------------------------------------------------- |
| `-e, --env <env>`    | Environment: `stage` \| `live` (default: `stage`) |
| `-d, --dm <shortID>` | DataManager short ID                              |
| `-m, --model <name>` | Model name                                        |
| `-i, --id <id>`      | Entry ID or DataManager UUID (context-dependent)  |
| `--data <json>`      | JSON data (for create/edit)                       |
| `-s, --size <n>`     | Page size for list                                |
| `-p, --page <n>`     | Page number for list                              |
| `--sort <field>`     | Sort field for list                               |
| `-f, --filter <k=v>` | Filter for list (repeatable)                     |
| `--raw`              | Include `_links` and `_embedded` in output        |
| `--md`               | Output entries as readable markdown table          |
| `-v, --version`      | Show version                                      |
| `-h, --help`         | Show help                                         |

### Examples

```sh
# Login to stage (stores token in ~/.ec-fdk/auth.json)
ec.fdk login -e stage

# List datamanagers
ec.fdk dmList -e stage

# Get a single datamanager
ec.fdk getDatamanager -e stage --id 73538731-4ac3-4a1a-b3b5-e31d09e94d42

# List models of a datamanager
ec.fdk modelList -e stage --id 73538731-4ac3-4a1a-b3b5-e31d09e94d42

# Filter models by title
ec.fdk modelList --id 73538731-4ac3-4a1a-b3b5-e31d09e94d42 -f title~=muffin

# List entries
ec.fdk entryList -d 83cc6374 -m muffin

# List with pagination
ec.fdk entryList -d 83cc6374 -m muffin -s 10 -p 2

# Get a single entry
ec.fdk getEntry -d 83cc6374 -m muffin -i fZctZXIeRJ

# Create an entry
ec.fdk createEntry -d 83cc6374 -m muffin --data '{"name":"new muffin","amazement_factor":10}'

# Create via stdin pipe
echo '{"name":"piped muffin","amazement_factor":10}' | ec.fdk createEntry -d 83cc6374 -m muffin

# Edit an entry
ec.fdk editEntry -d 83cc6374 -m muffin -i fZctZXIeRJ --data '{"name":"edited"}'

# Delete an entry
ec.fdk deleteEntry -d 83cc6374 -m muffin -i fZctZXIeRJ

# Get model schema
ec.fdk getSchema -d 83cc6374 -m muffin

# Filter entries (repeatable -f for arbitrary query params)
ec.fdk entryList -d 83cc6374 -m muffin -f name~=chocolate
ec.fdk entryList -d 83cc6374 -m muffin -f amazement_factorFrom=5 -f amazement_factorTo=10
ec.fdk entryList -d 83cc6374 -m muffin -f createdFrom=2024-01-01

# Filter datamanagers
ec.fdk dmList -f title~=ec-admin

# Pipe into jq
ec.fdk entryList -d 83cc6374 -m muffin | jq '.items | length'
```

The `-f` flag maps directly to [entrecode filter query params](https://doc.entrecode.de/api-basics/#filtering). Common filter suffixes:

| Suffix     | Meaning              | Example                        |
| ---------- | -------------------- | ------------------------------ |
| `~`        | Search (contains)    | `-f name~=chocolate`           |
| `From`     | Greater than / after | `-f createdFrom=2024-01-01`    |
| `To`       | Less than / before   | `-f createdTo=2025-01-01`      |
| (none)     | Exact match          | `-f amazement_factor=10`       |

Status/error messages go to stderr, data goes to stdout â€” so piping always works cleanly.

## migration from ec.sdk

ec.fdk won't change / decorate data returned from ec APIs. For example, an entry returned from the datamanager will be returned as is.
Advantages:

- The network tab shows what goes into the frontend
- Resources have the same shape everywhere
- Resources are serializable

### Entry save

Instead of mutating an EntryResource and calling `.save()`, we now pass the new `value` directly:

```js
// this does not exist anymore:
await entry.save(); // <- DONT
// use this to update an entry:
await editEntryObject(entry, value); // <- DO
// alternatively:
await fdk.env(env).dm(dmShortID).model(model).updateEntry(entryID, value);
// or:
await act({ action: 'editEntry', env, dmShortID, model, entryID, value });
```

### Entry delete

Similar to save:

```js
// this does not exist anymore:
await entry.del(); // <- DONT
// use this to delete an entry:
await deleteEntryObject(entry); // <- DO
// alternatively:
await fdk.dm('shortID').model('model').deleteEntry('entryID');
// or:
await act({ action: 'deleteEntry', env, dmShortID, model, entryID });
```

### Entry Asset Fields

In ec.fdk, entry asset fields are plain ids:

```js
// assuming "photo" is an asset field:
entry.photo; // <-- this used to be an AssetResource. Now it's a plain id string.
// use this to get the embedded AssetResource:
getEntryAsset('photo', entry); // (no request goes out)
```

### Entry Date Fields

```js
// assuming "lastSeen" is a datetime field:
entry.lastSeen; // <-- this used to be an instance of Date. Now it's a date ISO string
// use this to get a Date instance:
new Date(entry.lastSeen);
```

### Entry List

```js
// ec.sdk
const api = new PublicAPI(shortID, env, true);
const entryList = await api.entryList(model);
const items = entryList.getAllItems();
const first = entryList.getFirstItem();
// ec.fdk
const api = fdk(env).dm(shortID);
const entryList = await api.entryList(model);
const items = entryList.items; // <------- change
const first = entryList.items[0]; // <------- change
// or in one line:
const entryList = await fdk(env).dm(shortID).entryList(model);
```

### Entry List Filter Options

By default, the second param of ec.fdk `entryList` will just convert the object to url params:

```js
const entryList = await fdk('stage').dm('83cc6374').entryList({ createdTo: '2021-01-18T09:13:47.605Z' });
/* 
https://datamanager.cachena.entrecode.de/api/83cc6374/muffin?
_list=true&
createdTo=2021-01-18T09:13:47.605Z&
page=1&
size=50
*/
```

Read more in the [entrecode filtering doc](https://doc.entrecode.de/api-basics/#filtering)

There is some syntax sugar you can use to get the same behavior as [ec.sdk filterOptions](https://entrecode.github.io/ec.sdk/#filteroptions):

```js
const entryList = await fdk('stage')
  .dm('83cc6374')
  .entryList(filterOptions({ created: { to: '2021-01-18T09:13:47.605Z' } }));
```

### Asset List

```js
// ec.sdk
await api.dmAssetList(group, { assetID: { any: value } });
// ec.fdk
const options = sdkOptions({ assetID: { any: value } } as any);
const assets = await api.assetGroup(group).assetList(options);
```

### Load Asset

```js
// ec.sdk
api.dmAsset(group, img);
// ec.fdk
api.assetGroup(group).getAsset(img);
```

## Publish

0. `cd packages/ec.fdk`
1. bump version in `packages/ec.fdk/package.json`
2. run `npm run docs` to regenerate docs folder
3. commit + push
4. run `pnpm publish`
